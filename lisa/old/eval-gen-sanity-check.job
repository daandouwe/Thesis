#!/bin/bash
#SBATCH -N 1
#SBATCH -p normal
#SBATCH -J eval-gen-rnng-sanity-check
#SBATCH -o lisa/out/eval-gen-rnng-sanity-check.out
#SBATCH -t 3-00:00:00

export MKL_NUM_THREADS=1

# send an e-mail when the job starts
echo "Job $SLURM_JOB_NAME started at `date`" | mail $USER -s "Started job $SLURM_JOB_NAME"

# write sterr and stout of each experiment here
OUTPUT_DIR=${HOME}/thesis/lisa/out/${SLURM_JOB_NAME}
mkdir -p ${OUTPUT_DIR}

# always run from the main directory
cd ${HOME}/thesis

source lisa/lisa-cpu.sh

MODEL=models/gen-rnng-retry_dev=99.34
PROPS=data/proposals/rnng-dev.props
PROPS_NAME=rnng-dev

for i in {1..10}; do
  python src/main.py predict \
    --dynet-autobatch 1 \
    --dynet-mem 2000 \
    --model-type gen-rnng \
    --perplexity \
    --checkpoint ${MODEL} \
    --proposal-samples ${PROPS} \
    --outfile models/${MODEL}/output/sanity-check_proposals=${PROPS_NAME}_rep=${i}.tsv \
    &
done

wait

echo "Jobs finished"
echo "Job $SLURM_JOB_NAME ended at `date`" | mail $USER -s "Ended job $SLURM_JOB_NAME"

sleep 300
